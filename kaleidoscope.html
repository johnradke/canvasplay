<!DOCTYPE html>
<html>
<head>
    <title>kaleidescope</title>
</head>
<body>
    <canvas id="canvas" style="border:1px solid #aaa;"></canvas>
</body>

<script src="script/bedrock.js"></script>
<script src="script/canvasproxy.js"></script>
<script>
window.onload = function() {
    var cv = new CanvasProxy($.id('canvas'), { 
        fillScreen: true,
        centerOrigin: true
    });

    cv.lineWidth = 50;
    var trans = .5;
    cv.setLinearGradient(rgba(255,0,0,trans),
        rgba(255,165,0,trans),
        rgba(255, 255, 0, trans), 
        rgba(0, 255, 0, trans),
        rgba(0, 0, 255, trans),
        rgba(127, 0, 127, trans));

    var lineLength = 60;

    var path = new MaxQueue(lineLength);

    cv.eachFrame = function() {
        if (this.isMouseDown() && !this.getMousePos().equals(path[0])) {
            var lastPos = null;
            cv.clear();

            if (path.length >= 2) {
                // [x, 0, 0, y, 0, 0] scales by (x, y)
                // [0, x, y, 0, 0, 0] scales by (y, x)
                var transforms = [
                    [1, 0, 0, 1, 0, 0],
                    [0, 1, 1, 0, 0, 0],
                    [-1, 0, 0, 1, 0, 0],
                    [0, -1, 1, 0, 0, 0],
                    [-1, 0, 0, -1, 0, 0],
                    [0, -1, -1, 0, 0, 0],
                    [1, 0, 0, -1, 0, 0],
                    [0, 1, -1, 0, 0, 0]
                ];

                transforms.forEach(function(transform) {
                    cv.withTransform(transform, function() {
                        cv.drawPath(path);
                    });
                });
            }

            path.Add(this.getMousePos());
        }
    }

    cv.startAnimation();
};
</script>

</html>