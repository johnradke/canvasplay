<!DOCTYPE html>
<html>
<head>
    <title>kaleidescope</title>
</head>
<body>
    <canvas id="canvas" style="border:1px solid #aaa;"></canvas>
</body>

<script src="script/bedrock.js"></script>
<script src="script/canvasproxy.js"></script>
<script>
window.onload = function() {
    var cv = new CanvasProxy($.id('canvas'), { 
        fillScreen: true,
        centerOrigin: true
    });

    cv.lineWidth = 4;

    var lineLength = 60;

    var path = new MaxQueue(lineLength);

    cv.eachFrame = function() {
        if (this.isMouseDown() && !this.getMousePos().equals(path[0])) {
            var lastPos = null;
            cv.clear();

            if (path.length >= 2) {
                var diagReflect = [0, 1, 1, 0, 0, 0];

                function drawDiag() {
                    cv.drawPath(path);
                    cv.withTransform(diagReflect, function() {
                        cv.drawPath(path);
                    });
                }

                drawDiag();

                cv.withScale(-1, 1, function() {
                    drawDiag();
                });

                cv.withScale(1, -1, function() {
                    drawDiag();
                });

                cv.withScale(-1, -1, function() {
                    drawDiag();
                });
            }

            path.Add(this.getMousePos());
        }
    }

    cv.startAnimation();
};
</script>

</html>